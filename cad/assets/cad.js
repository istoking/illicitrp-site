const API=(window.CAD_API||'').trim()||'https://cad-api.illicitrp.com';async function api(path,opts={}){const r=await fetch(API+path,{credentials:'include',headers:{'Content-Type':'application/json'},...opts});if(!r.ok)throw new Error('API error');return r.json();}function setActiveNav(){const p=location.pathname;document.querySelectorAll('[data-nav]').forEach(a=>a.classList.toggle('active',p.endsWith(a.getAttribute('href'))));}async function loadMe(){try{const me=await api('/me');document.getElementById('meName').textContent=me.discord_name||me.discord_id;document.getElementById('meRoles').textContent=(me.role_names||[]).join(', ');document.getElementById('loginBtn').style.display='none';document.getElementById('logoutBtn').style.display='inline-flex';return me;}catch{document.getElementById('meName').textContent='Not signed in';document.getElementById('meRoles').textContent='Login with Discord to continue';document.getElementById('loginBtn').style.display='inline-flex';document.getElementById('logoutBtn').style.display='none';return null;}}async function logout(){await api('/auth/logout',{method:'POST',body:'{}'});location.href='/cad/';}document.addEventListener('DOMContentLoaded',()=>{setActiveNav();loadMe();document.getElementById('loginBtn')?.addEventListener('click',()=>location.href=API+'/auth/discord');document.getElementById('logoutBtn')?.addEventListener('click',logout);const apiHost=document.getElementById('apiHost');if(apiHost)apiHost.textContent=API.replace(/^https?:\/\//,'');});window.CAD={api,API};